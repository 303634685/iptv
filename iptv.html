<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="hbo.png">
    <link href="https://cdn.bootcss.com/video.js/7.6.5/video-js.min.css" rel="stylesheet">
    <style>
      a {
        color: #70B7FD;
        text-decoration: none;
      }
      
      body {
        width: 95%;
        margin: 0 auto;
        font: 1em/1.2 'PingFangSC','helvetica neue','hiragino sans gb','arial','microsoft yahei ui','microsoft yahei','simsun','sans-serif';
        display: grid;
        grid-template-columns: 1fr 2fr;
        grid-gap: 20px;
      }

      header {
        grid-column: 1 / 3;
        grid-row: 1;
      }

      .videoContainer {
        grid-column: 2;
        grid-row: 2;
        width: 80%;
      }

      .vjs-subs-caps-button {
        display: none;
      }

      aside {
        grid-column: 1;
        grid-row: 2;
        padding-left: .5em;
        padding-right: 1em;
        text-align: right;
        border-right: 1px solid #999;
      }

      fieldset {
        min-width: 0;
        padding: 0;
        margin: 0;
        border: 0;
      }

      .categories {
        grid-column: 1 / 3;
        grid-row: 3;
        text-align: center;
      }

      section {
        grid-column: 1 / 3;
        grid-row: 4;
        text-align: center;
      }

      .sources {
        display: inline-block;
        margin-top: 0;
        padding: 0;
      }

      .sources li {
        display: block;
        text-decoration: none;
        letter-spacing: 1px;
        text-transform: uppercase;
        border: 2px solid rgba(0,0,200,0.6);
        background: rgba(112,183,253,0.3);
        color: rgba(0,0,200,0.6);
        box-shadow: 1px 1px 2px rgba(0,0,200,0.4);
        border-radius: 10px;
        padding: 3px 10px;
        margin-bottom: 10px;
        cursor: pointer;
      }

      .regImg {
        display: inline-block;
      }

      .categories li, .channels li, .formToggle, button {
        display: inline-block;
        text-decoration: none;
        letter-spacing: 1px;
        text-transform: uppercase;
        border: 2px solid rgba(0,0,200,0.6);
        background: rgba(112,183,253,0.3);
        color: rgba(0,0,200,0.6);
        box-shadow: 1px 1px 2px rgba(0,0,200,0.4);
        border-radius: 10px;
        padding: 3px 10px;
        margin-bottom: 10px;
        cursor: pointer;
      }

      button {
        font-size: .9em;
      }

      .working {
        border: 2px solid rgba(0, 200, 0, 0.6) !important;
        background:rgba(47, 201, 96, 0.3) !important;
      }

      .sources .sourceReg, .categories .selected, .channels .selected {
        color: white;
        background: red !important;
      }

      li {
        margin-left: .5em;
      }

      aside h3 {
        margin-top: 0;
      }

      .hidden {
        display: none !important;
      }

      .white {
        color: white !important;
      }

      h4 {
        color: red;
      }

      .bgBlack {
        background-color: black !important;
      }

      input {
        display: inline-block;
        text-align: center;
        font-size: 1em;
        border-radius: 1px;
        box-sizing: border-box;
        height: 2em;
        max-width: 8em;
      }

      form div + div {
        margin-top: 1em;
      }

      footer {
        background: #F3F3F3;
        padding: .5em;
        letter-spacing: 1px;
        position: fixed;
        left: 0;
        bottom: 0;
      }

      footer span {
        margin-left: .5em;
        margin-right: .5em;
      }

      .video-js .vjs-overlay {
        color: #fff;
        position: absolute;
        text-align: center;
      }

      .video-js .vjs-overlay-background {
        background-color: #646464;
        border-radius: 3px;
        height: 15%;
        width: 19%;
      }

      .video-js .vjs-overlay-center {
        left: 50%;
        top: 50%;
        margin-left: 28%;
        margin-top: 17%;
      }

      @media (max-width: 991.98px) {
        header {
          padding-left: 1em;
        }
        .videoContainer {
          width: 95%;
        }
        .categories .hbohd {
          display: none;
        }
        footer span {
            display: none;
        }
      }

      @media (min-width: 992px) {
        header {
          grid-column: 2;
          grid-row: 1;
        }
      }

      svg {
        fill:#70B7FD; 
        color:#fff; 
        position: absolute; 
        top: 0; 
        border: 0; 
        right: 0;
      }

      .github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}
    </style>
    <title>HBO直播 - 高清电视直播</title>
    <!--[if lt IE 9]>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body>
    <header>
      <h1>
        <a href="/">HBO中文直播</a>
      </h1>
      <p>部分广电直播源需手机号注册！<!--[if lt IE 10]><p class="warn"><strong>不支持 IE浏览器</strong> 。</p><![endif]--></p>
      <a href="https://github.com/woniuzfb/iptv" target="_blank" class="github-corner">
        <svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true">
          <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
          <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
          <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
      </a>
    </header>
    <div class="videoContainer"></div>
    <div class="categories">
      <ul>
        <li data-value="hbo" data-source="a8">HBO</li>
        <li data-value="hbohd" data-source="hbo">HBO高清</li>
        <li data-value="myList1" class="dianxin">高清&bull;电信</li>
        <li data-value="myList1a" class="liantong">高清&bull;联通</li>
        <li data-value="myList2">标清</li>
        <li data-value="myList3">央视</li>
        <li data-value="myList4">卫视</li>
        <li data-value="myList5">地方</li>
        <li data-value="myList8">专业</li>
        <li data-value="myList9">港澳台</li>
        <li data-value="0" class="switch">关灯</li>
      </ul>
    </div>
    <section>
      <div class="channels">
        <ul></ul>
        <ul></ul>
        <ul></ul>
        <ul></ul>
        <ul></ul>
        <ul></ul>
        <ul></ul>
        <ul></ul>
      </div>
    </section>
    <aside>
      <h3>直播源</h3>
      <ul class="sources"></ul>
      <form class="loginForm">
        <fieldset>
          <h3>登录账号</h3>
          <div><input class="loginAcc" type="text" placeholder="用户名"></div>
          <div><input class="loginPwd" type="password" placeholder="密码"></div>
          <div><button class="loginBtn" type="button">登录</button></div>
        </fieldset>
      </form>
      <form class="regForm hidden">
        <fieldset>
          <h3>注册账号</h3>
          <div><input class="regAcc" type="text" placeholder="用户名"></div>
          <div><input class="regPwd" type="password" placeholder="密码"></div>
          <div class="regImg"></div><input type="hidden" class="regImgId">
          <div><input class="regImgInput hidden" type="text" placeholder="图片验证码"></div>
          <div><input class="regSms hidden" type="text" placeholder="短信验证码"></div>
          <div><button class="regBtn" type="button">注册</button></div>
        </fieldset>
      </form>
      <button class="formToggle" type="button">注册</button>
      <h4></h4>
    </aside>
    <footer>
      By MTimer<span>&bull;</span>
      <a href="https://github.com/woniuzfb/iptv" target="_blank">@iptv</a>
    </footer>
    <script src="https://cdn.bootcss.com/video.js/7.6.5/video.min.js"></script>
    <script src="https://cdn.bootcss.com/flv.js/1.5.0/flv.min.js"></script>
    <script>
/*videojs-overlay*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js"),require("global/window")):"function"==typeof define&&define.amd?define(["video.js","global/window"],e):t.videojsOverlay=e(t.videojs,t.window)}(this,function(t,e){"use strict";function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var r={align:"top-left",class:"",content:"This overlay will show up while the video is playing",debug:!1,showBackground:!0,attachToControlBar:!1,overlays:[{start:"playing",end:"paused"}]},i=t.getComponent("Component"),o=t.dom||t,s=t.registerPlugin||t.plugin,a=function(t){return"number"==typeof t&&t==t},h=function(t){return"string"==typeof t&&/^\S+$/.test(t)},d=function(r){var i,s;function d(t,e){var i;return i=r.call(this,t,e)||this,["start","end"].forEach(function(t){var e=i.options_[t];if(a(e))i[t+"Event_"]="timeupdate";else if(h(e))i[t+"Event_"]=e;else if("start"===t)throw new Error('invalid "start" option; expected number or string')}),["endListener_","rewindListener_","startListener_"].forEach(function(t){i[t]=function(e){return d.prototype[t].call(n(n(i)),e)}}),"timeupdate"===i.startEvent_&&i.on(t,"timeupdate",i.rewindListener_),i.debug('created, listening to "'+i.startEvent_+'" for "start" and "'+(i.endEvent_||"nothing")+'" for "end"'),i.hide(),i}s=r,(i=d).prototype=Object.create(s.prototype),i.prototype.constructor=i,i.__proto__=s;var l=d.prototype;return l.createEl=function(){var t=this.options_,n=t.content,r=t.showBackground?"vjs-overlay-background":"vjs-overlay-no-background",i=o.createEl("div",{className:"\n        vjs-overlay\n        vjs-overlay-"+t.align+"\n        "+t.class+"\n        "+r+"\n        vjs-hidden\n      "});return"string"==typeof n?i.innerHTML=n:n instanceof e.DocumentFragment?i.appendChild(n):o.appendContent(i,n),i},l.debug=function(){if(this.options_.debug){for(var e=t.log,n=e,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];e.hasOwnProperty(i[0])&&"function"==typeof e[i[0]]&&(n=e[i.shift()]),n.apply(void 0,["overlay#"+this.id()+": "].concat(i))}},l.hide=function(){return r.prototype.hide.call(this),this.debug("hidden"),this.debug('bound `startListener_` to "'+this.startEvent_+'"'),this.endEvent_&&(this.debug('unbound `endListener_` from "'+this.endEvent_+'"'),this.off(this.player(),this.endEvent_,this.endListener_)),this.on(this.player(),this.startEvent_,this.startListener_),this},l.shouldHide_=function(t,e){var n=this.options_.end;return a(n)?t>=n:n===e},l.show=function(){return r.prototype.show.call(this),this.off(this.player(),this.startEvent_,this.startListener_),this.debug("shown"),this.debug('unbound `startListener_` from "'+this.startEvent_+'"'),this.endEvent_&&(this.debug('bound `endListener_` to "'+this.endEvent_+'"'),this.on(this.player(),this.endEvent_,this.endListener_)),this},l.shouldShow_=function(t,e){var n=this.options_.start,r=this.options_.end;return a(n)?a(r)?t>=n&&t<r:this.hasShownSinceSeek_?Math.floor(t)===n:(this.hasShownSinceSeek_=!0,t>=n):n===e},l.startListener_=function(t){var e=this.player().currentTime();this.shouldShow_(e,t.type)&&this.show()},l.endListener_=function(t){var e=this.player().currentTime();this.shouldHide_(e,t.type)&&this.hide()},l.rewindListener_=function(t){var e=this.player().currentTime(),n=this.previousTime_,r=this.options_.start,i=this.options_.end;e<n&&(this.debug("rewind detected"),a(i)&&!this.shouldShow_(e)?(this.debug("hiding; "+i+" is an integer and overlay should not show at this time"),this.hasShownSinceSeek_=!1,this.hide()):h(i)&&e<r&&(this.debug("hiding; show point ("+r+") is before now ("+e+") and end point ("+i+") is an event"),this.hasShownSinceSeek_=!1,this.hide())),this.previousTime_=e},d}(i);t.registerComponent("Overlay",d);var l=function(e){var n=this,i=t.mergeOptions(r,e);Array.isArray(this.overlays_)&&this.overlays_.forEach(function(t){n.removeChild(t),n.controlBar&&n.controlBar.removeChild(t),t.dispose()});var o=i.overlays;delete i.overlays,this.overlays_=o.map(function(e){var r=t.mergeOptions(i,e),o="string"==typeof r.attachToControlBar||!0===r.attachToControlBar;if(!n.controls()||!n.controlBar)return n.addChild("overlay",r);if(o&&-1!==r.align.indexOf("bottom")){var s=n.controlBar.children()[0];if(void 0!==n.controlBar.getChild(r.attachToControlBar)&&(s=n.controlBar.getChild(r.attachToControlBar)),s){var a=n.controlBar.addChild("overlay",r);return n.controlBar.el().insertBefore(a.el(),s.el()),a}}var h=n.addChild("overlay",r);return n.el().insertBefore(h.el(),n.controlBar.el()),h})};return l.VERSION="2.1.4",s("overlay",l),l});
/*videojs-flvjs*/
!function e(t,r,o){function n(l,f){if(!r[l]){if(!t[l]){var u="function"==typeof require&&require;if(!f&&u)return u(l,!0);if(i)return i(l,!0);var a=new Error("Cannot find module '"+l+"'");throw a.code="MODULE_NOT_FOUND",a}var c=r[l]={exports:{}};t[l][0].call(c.exports,function(e){var r=t[l][1][e];return n(r||e)},c,c.exports,e,t,r,o)}return r[l].exports}for(var i="function"==typeof require&&require,l=0;l<o.length;l++)n(o[l]);return n}({1:[function(e,t,r){(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),l=function e(t,r,o){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,o)}if("value"in n)return n.value;var l=n.get;if(void 0!==l)return l.call(o)},f="undefined"!=typeof window?window.videojs:void 0!==e?e.videojs:null,u=function(e){return e&&e.__esModule?e:{default:e}}(f),a=u.default.getTech("Html5"),c=u.default.mergeOptions||u.default.util.mergeOptions,s={mediaDataSource:{},config:{}},p=function(e){function r(e,n){return t(this,r),e=c(s,e),o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e,n))}return n(r,e),i(r,[{key:"setSrc",value:function(e){this.flvPlayer&&(this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy());var t=this.options_.mediaDataSource,r=this.options_.config;t.type=void 0===t.type?"flv":t.type,t.url=e,this.flvPlayer=window.flvjs.createPlayer(t,r),this.flvPlayer.attachMediaElement(this.el_),this.flvPlayer.load()}},{key:"dispose",value:function(){this.flvPlayer&&(this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy()),l(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"dispose",this).call(this)}}]),r}(a);p.isSupported=function(){return window.flvjs&&window.flvjs.isSupported()},p.formats={"video/flv":"FLV","video/x-flv":"FLV"},p.canPlayType=function(e){return p.isSupported()&&e in p.formats?"maybe":""},p.canPlaySource=function(e,t){return p.canPlayType(e.type)},p.VERSION="0.2.0",u.default.registerTech("Flvjs",p),r.default=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);
/*md5*/
!function(n){"use strict";function t(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}function r(n,t){return n<<t|n>>>32-t}function e(n,e,o,u,c,f){return t(r(t(t(e,n),t(u,f)),c),o)}function o(n,t,r,o,u,c,f){return e(t&r|~t&o,n,t,u,c,f)}function u(n,t,r,o,u,c,f){return e(t&o|r&~o,n,t,u,c,f)}function c(n,t,r,o,u,c,f){return e(t^r^o,n,t,u,c,f)}function f(n,t,r,o,u,c,f){return e(r^(t|~o),n,t,u,c,f)}function i(n,r){n[r>>5]|=128<<r%32,n[14+(r+64>>>9<<4)]=r;var e,i,a,d,h,l=1732584193,g=-271733879,v=-1732584194,m=271733878;for(e=0;e<n.length;e+=16)i=l,a=g,d=v,h=m,g=f(g=f(g=f(g=f(g=c(g=c(g=c(g=c(g=u(g=u(g=u(g=u(g=o(g=o(g=o(g=o(g,v=o(v,m=o(m,l=o(l,g,v,m,n[e],7,-680876936),g,v,n[e+1],12,-389564586),l,g,n[e+2],17,606105819),m,l,n[e+3],22,-1044525330),v=o(v,m=o(m,l=o(l,g,v,m,n[e+4],7,-176418897),g,v,n[e+5],12,1200080426),l,g,n[e+6],17,-1473231341),m,l,n[e+7],22,-45705983),v=o(v,m=o(m,l=o(l,g,v,m,n[e+8],7,1770035416),g,v,n[e+9],12,-1958414417),l,g,n[e+10],17,-42063),m,l,n[e+11],22,-1990404162),v=o(v,m=o(m,l=o(l,g,v,m,n[e+12],7,1804603682),g,v,n[e+13],12,-40341101),l,g,n[e+14],17,-1502002290),m,l,n[e+15],22,1236535329),v=u(v,m=u(m,l=u(l,g,v,m,n[e+1],5,-165796510),g,v,n[e+6],9,-1069501632),l,g,n[e+11],14,643717713),m,l,n[e],20,-373897302),v=u(v,m=u(m,l=u(l,g,v,m,n[e+5],5,-701558691),g,v,n[e+10],9,38016083),l,g,n[e+15],14,-660478335),m,l,n[e+4],20,-405537848),v=u(v,m=u(m,l=u(l,g,v,m,n[e+9],5,568446438),g,v,n[e+14],9,-1019803690),l,g,n[e+3],14,-187363961),m,l,n[e+8],20,1163531501),v=u(v,m=u(m,l=u(l,g,v,m,n[e+13],5,-1444681467),g,v,n[e+2],9,-51403784),l,g,n[e+7],14,1735328473),m,l,n[e+12],20,-1926607734),v=c(v,m=c(m,l=c(l,g,v,m,n[e+5],4,-378558),g,v,n[e+8],11,-2022574463),l,g,n[e+11],16,1839030562),m,l,n[e+14],23,-35309556),v=c(v,m=c(m,l=c(l,g,v,m,n[e+1],4,-1530992060),g,v,n[e+4],11,1272893353),l,g,n[e+7],16,-155497632),m,l,n[e+10],23,-1094730640),v=c(v,m=c(m,l=c(l,g,v,m,n[e+13],4,681279174),g,v,n[e],11,-358537222),l,g,n[e+3],16,-722521979),m,l,n[e+6],23,76029189),v=c(v,m=c(m,l=c(l,g,v,m,n[e+9],4,-640364487),g,v,n[e+12],11,-421815835),l,g,n[e+15],16,530742520),m,l,n[e+2],23,-995338651),v=f(v,m=f(m,l=f(l,g,v,m,n[e],6,-198630844),g,v,n[e+7],10,1126891415),l,g,n[e+14],15,-1416354905),m,l,n[e+5],21,-57434055),v=f(v,m=f(m,l=f(l,g,v,m,n[e+12],6,1700485571),g,v,n[e+3],10,-1894986606),l,g,n[e+10],15,-1051523),m,l,n[e+1],21,-2054922799),v=f(v,m=f(m,l=f(l,g,v,m,n[e+8],6,1873313359),g,v,n[e+15],10,-30611744),l,g,n[e+6],15,-1560198380),m,l,n[e+13],21,1309151649),v=f(v,m=f(m,l=f(l,g,v,m,n[e+4],6,-145523070),g,v,n[e+11],10,-1120210379),l,g,n[e+2],15,718787259),m,l,n[e+9],21,-343485551),l=t(l,i),g=t(g,a),v=t(v,d),m=t(m,h);return[l,g,v,m]}function a(n){var t,r="",e=32*n.length;for(t=0;t<e;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}function d(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t<e;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}function h(n){return a(i(d(n),8*n.length))}function l(n,t){var r,e,o=d(n),u=[],c=[];for(u[15]=c[15]=void 0,o.length>16&&(o=i(o,8*n.length)),r=0;r<16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(d(t)),512+8*t.length),a(i(c.concat(e),640))}function g(n){var t,r,e="";for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),e+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return e}function v(n){return unescape(encodeURIComponent(n))}function m(n){return h(v(n))}function p(n){return g(m(n))}function s(n,t){return l(v(n),v(t))}function C(n,t){return g(s(n,t))}function A(n,t,r){return t?r?s(t,n):C(t,n):r?m(n):p(n)}"function"==typeof define&&define.amd?define(function(){return A}):"object"==typeof module&&module.exports?module.exports=A:n.md5=A}(this);
/*promise*/
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n():"function"==typeof define&&define.amd?define(n):n()}(0,function(){"use strict";function e(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}function n(){}function t(e){if(!(this instanceof t))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=undefined,this._deferreds=[],u(e,this)}function o(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,t._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var o;try{o=t(e._value)}catch(f){return void i(n.promise,f)}r(n.promise,o)}else(1===e._state?r:i)(n.promise,e._value)})):e._deferreds.push(n)}function r(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var o=n.then;if(n instanceof t)return e._state=3,e._value=n,void f(e);if("function"==typeof o)return void u(function(e,n){return function(){e.apply(n,arguments)}}(o,n),e)}e._state=1,e._value=n,f(e)}catch(r){i(e,r)}}function i(e,n){e._state=2,e._value=n,f(e)}function f(e){2===e._state&&0===e._deferreds.length&&t._immediateFn(function(){e._handled||t._unhandledRejectionFn(e._value)});for(var n=0,r=e._deferreds.length;r>n;n++)o(e,e._deferreds[n]);e._deferreds=null}function u(e,n){var t=!1;try{e(function(e){t||(t=!0,r(n,e))},function(e){t||(t=!0,i(n,e))})}catch(o){if(t)return;t=!0,i(n,o)}}var c=setTimeout;t.prototype["catch"]=function(e){return this.then(null,e)},t.prototype.then=function(e,t){var r=new this.constructor(n);return o(this,new function(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}(e,t,r)),r},t.prototype["finally"]=e,t.all=function(e){return new t(function(n,t){function o(e,f){try{if(f&&("object"==typeof f||"function"==typeof f)){var u=f.then;if("function"==typeof u)return void u.call(f,function(n){o(e,n)},t)}r[e]=f,0==--i&&n(r)}catch(c){t(c)}}if(!e||"undefined"==typeof e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return n([]);for(var i=r.length,f=0;r.length>f;f++)o(f,r[f])})},t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===t?e:new t(function(n){n(e)})},t.reject=function(e){return new t(function(n,t){t(e)})},t.race=function(e){return new t(function(n,t){for(var o=0,r=e.length;r>o;o++)e[o].then(n,t)})},t._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){c(e,0)},t._unhandledRejectionFn=function(e){void 0!==console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}();"Promise"in l?l.Promise.prototype["finally"]||(l.Promise.prototype["finally"]=e):l.Promise=t});
/*fetch*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.WHATWGFetch={})}(this,function(a){"use strict";var e="URLSearchParams"in self,r="Symbol"in self&&"iterator"in Symbol,h="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),o="FormData"in self,n="ArrayBuffer"in self;if(n)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=ArrayBuffer.isView||function(t){return t&&-1<i.indexOf(Object.prototype.toString.call(t))};function u(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function t(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function c(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function p(r){return new Promise(function(t,e){r.onload=function(){t(r.result)},r.onerror=function(){e(r.error)}})}function y(t){var e=new FileReader,r=p(e);return e.readAsArrayBuffer(t),r}function l(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){(this._bodyInit=t)?"string"==typeof t?this._bodyText=t:h&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:o&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:e&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():n&&h&&function(t){return t&&DataView.prototype.isPrototypeOf(t)}(t)?(this._bodyArrayBuffer=l(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n&&(ArrayBuffer.prototype.isPrototypeOf(t)||s(t))?this._bodyArrayBuffer=l(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},h&&(this.blob=function(){var t=c(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?c(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var t=c(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,r=p(e);return e.readAsText(t),r}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),o=0;o<e.length;o++)r[o]=String.fromCharCode(e[o]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(t,e){t=u(t),e=f(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},d.prototype.delete=function(t){delete this.map[u(t)]},d.prototype.get=function(t){return t=u(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(u(t))},d.prototype.set=function(t,e){this.map[u(t)]=f(e)},d.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},d.prototype.keys=function(){var r=[];return this.forEach(function(t,e){r.push(e)}),t(r)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),t(e)},d.prototype.entries=function(){var r=[];return this.forEach(function(t,e){r.push([e,t])}),t(r)},r&&(d.prototype[Symbol.iterator]=d.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function w(t,e){var r=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<m.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function v(t){var n=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),r=e.shift().replace(/\+/g," "),o=e.join("=").replace(/\+/g," ");n.append(decodeURIComponent(r),decodeURIComponent(o))}}),n}function E(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var A=[301,302,303,307,308];E.redirect=function(t,e){if(-1===A.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},a.DOMException=self.DOMException;try{new a.DOMException}catch(t){a.DOMException=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack},a.DOMException.prototype=Object.create(Error.prototype),a.DOMException.prototype.constructor=a.DOMException}function _(i,s){return new Promise(function(r,t){var e=new w(i,s);if(e.signal&&e.signal.aborted)return t(new a.DOMException("Aborted","AbortError"));var o=new XMLHttpRequest;function n(){o.abort()}o.onload=function(){var t={status:o.status,statusText:o.statusText,headers:function(t){var n=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),r=e.shift().trim();if(r){var o=e.join(":").trim();n.append(r,o)}}),n}(o.getAllResponseHeaders()||"")};t.url="responseURL"in o?o.responseURL:t.headers.get("X-Request-URL");var e="response"in o?o.response:o.responseText;r(new E(e,t))},o.onerror=function(){t(new TypeError("Network request failed"))},o.ontimeout=function(){t(new TypeError("Network request failed"))},o.onabort=function(){t(new a.DOMException("Aborted","AbortError"))},o.open(e.method,e.url,!0),"include"===e.credentials?o.withCredentials=!0:"omit"===e.credentials&&(o.withCredentials=!1),"responseType"in o&&h&&(o.responseType="blob"),e.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),e.signal&&(e.signal.addEventListener("abort",n),o.onreadystatechange=function(){4===o.readyState&&e.signal.removeEventListener("abort",n)}),o.send(void 0===e._bodyInit?null:e._bodyInit)})}_.polyfill=!0,self.fetch||(self.fetch=_,self.Headers=d,self.Request=w,self.Response=E),a.Headers=d,a.Request=w,a.Response=E,a.fetch=_,Object.defineProperty(a,"__esModule",{value:!0})});

function makeStr(num) {
  let text = "";
  let possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  for (let i = 0; i < num; i++) {
    text += possible.charAt(Math.floor(Math.random() * possible.length));
  }
  return text;
}

function toggleClass(s,n) {
  let elements = document.querySelectorAll(s);
  for (let i = 0; i < elements.length; i++) {
    elements[i].classList.toggle(n);
  }
}

function switchSource(e) {
  if(e.target && e.target.nodeName === "LI") {
    sourceReg =  e.target.classList[0].substring(7);
    updateAside();
    programId = undefined;
  }
}

function switchCategory(e) {
  if(e.target && e.target.nodeName === "LI") {
    let catValue =  e.target.dataset.value;
    switch (catValue) {
      case "0":
      case "1":
        if(catValue === "0") {
          e.target.textContent = '开灯';
          e.target.dataset.value = 1;
          localStorage.setItem('dark', 1);
        } else {
          e.target.textContent = '关灯';
          e.target.dataset.value = 0;
          localStorage.setItem('dark', 0);
        }
        toggleClass('li','white');
        toggleClass('button','white');
        toggleClass('input','white');
        toggleClass('footer','white');
        toggleClass('a','white');
        toggleClass('body','bgBlack');
        toggleClass('input','bgBlack');
        toggleClass('footer','bgBlack');
        break;
      default:
        if (e.target.dataset.source) {
          sourceReg = e.target.dataset.source;
          programId = catValue;
          playVideo();
          const selected = document.querySelector('.selected');
          if(selected) selected.classList.remove('selected');
          e.target.classList.add('selected');
        } else {
          const mylist = document.querySelector('.'+catValue);
          let siblings = mylist.parentNode.childNodes;
          for(let i=0; i < siblings.length; i++) {
            if(siblings[i].nodeName === "UL") {
              siblings[i].classList.add('hidden');
            }
          }
          mylist.classList.remove('hidden');
        }
        break;
    }
  }
}

function switchChannel(e) {
  if(e.target) {
    if (e.target.nodeName === "LI") {
      sourceReg =  e.target.dataset.source;
      programId =  e.target.dataset.value;
      playVideo();
      const selected = document.querySelector('.selected');
      if(selected) selected.classList.remove('selected');
      e.target.classList.add('selected');
    } else if (e.target.nodeName === "SUB") {
      sourceReg =  e.target.parentNode.dataset.source;
      programId =  e.target.parentNode.dataset.value;
      playVideo();
      const selected = document.querySelector('.selected');
      if(selected) selected.classList.remove('selected');
      e.target.parentNode.classList.add('selected');
    }
  }
}

function videojsLoad() {
  if (videoField.hasChildNodes()) {
    videojs('video').dispose();
  }
  
  let contentType = hlsVideoUrl.indexOf('.flv') === -1 ? 'application/vnd.apple.mpegurl' : 'video/x-flv';
  const video = document.createElement('video');
  video.id = 'video';
  video.className = 'video-js';
  const noVideojs = document.createElement('p');
  noVideojs.className = 'vjs-no-js';
  const noVideojsText = document.createTextNode('需启用 JavaScript，或使用更新的浏览器');
  noVideojs.appendChild(noVideojsText);
  video.appendChild(noVideojs);
  videoField.appendChild(video);

  var player = videojs('video',{
    liveui: liveui,
    autoplay: 'true',
    preload: 'auto',
    textTrackSettings: false,
    controls: true,
    fluid: true,
    responsive: true
  });

  if (hlsVideoUrl.indexOf('qhmywl.com') !== -1) {
    player.overlay({
      debug: false,
      overlays: [{
        content: '',
        align: 'center',
        start: 'ready'
      }]
    });
  }

  player.src({
    src: hlsVideoUrl,
    type: contentType,
    overrideNative: true
  });

  player.ready(function() {
    let promise = player.play();

    if (promise !== undefined) {
      promise.then(function() {
        // Autoplay started!
      }).catch(function(error) {
        // Autoplay was prevented.
      });
    }
  });

  player.on('error', function(e) {
    let time = this.currentTime();
    if (this.error().code === 2) {
      alertInfo('频道发生错误！',10);
      this.error(null).pause().load().currentTime(time).play();
    } else if (this.error().code === 4) {
      alertInfo('频道不可用！请重新登录账号后尝试!',10);
      /*
      if (programId) {
        localStorage.removeItem(sourceReg+'_acc');
        localStorage.removeItem(sourceReg+'_pwd');
        localStorage.removeItem(sourceReg+'_token');
        localStorage.removeItem(sourceReg+'_deviceno');
      }
      */
    } else {
      alertInfo('无法连接直播源！',10);
    }
  });
}

function playVideo() {
  if(!programId) {
    hlsVideoUrl = sourcesJsonParsed.hbo.channels[0].url;
    resetSourceReg();
    videojsLoad();
  } else if (jsonChannels[sourceReg]) {
    hlsVideoUrl = jsonChannels[sourceReg][programId];
    resetSourceReg();
    videojsLoad();
  } else if (!sourcesJsonParsed.hasOwnProperty(sourceReg) || !sourcesJsonParsed[sourceReg].hasOwnProperty('channels')) {
    alertInfo('抱歉频道不可用！');
    resetSourceReg();
  } else if (!sourcesJsonParsed[sourceReg].hasOwnProperty('play_url')) {
    for (let a = 0; a < sourcesJsonParsed[sourceReg].channels.length; a++) {
      if (sourcesJsonParsed[sourceReg].channels[a].chnl_id === programId) {
        hlsVideoUrl = sourcesJsonParsed[sourceReg].channels[a].url;
        resetSourceReg();
        videojsLoad();
      }
    }
  } else if (sourcesJsonParsed[sourceReg].auth_info_url && sourcesJsonParsed[sourceReg].auth_verify_url && localStorage.getItem(sourceReg+'_token')) {
    reqAuth();
  } else if (localStorage.getItem(sourceReg+'_token')) {
    hlsVideoUrl = sourcesJsonParsed[sourceReg].play_url+'?playtype=live&protocol=hls&accesstoken='+localStorage.getItem(sourceReg+'_token')+'&playtoken=ABCDEFGHIGK&programid='+programId+'.m3u8';
    videojsLoad();
    updateAside();
  } else {
    alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源未注册或登录！',5);
    updateAside();
  }
}

function timeoutPromise(ms, promise) {
  return new Promise((resolve, reject) => {
    const timeoutId = setTimeout(() => {
      reject(new Error("promise timeout"))
    }, ms);
    promise.then(
      (res) => {
        clearTimeout(timeoutId);
        resolve(res);
      },
      (err) => {
        clearTimeout(timeoutId);
        reject(err);
      }
    );
  })
}

function reqData(url, data = '', method = 'GET') {
  if (method === 'GET') {
    return fetch(url + data, {
      method: method,
      mode: "cors",
      cache: "no-cache",
      credentials: "omit",
      referrer: "",
    }).then(response => response.json());
  } else {
    return fetch(url, {
      method: method,
      mode: "cors",
      cache: "no-cache",
      credentials: "omit",
      referrer: "",
      body: JSON.stringify(data),
    }).then(response => response.json());
  }
}

function alertInfo(info,delay=3) {
  infoField.textContent = info;
  setTimeout(function run() {
    if (infoField.textContent === info) {
      infoField.textContent = '';
    }
  }, delay*1000);
}

function uniqueName() {
  if (sourcesJsonParsed[sourceReg].hasOwnProperty('unique_url')) {
    reqData(sourcesJsonParsed[sourceReg].unique_url,'?accounttype='+sourcesJsonParsed[sourceReg].acc_type_reg+'&username='+regAccField.value)
    .then(response => {
      if (response.ret !== 0) {
        alertInfo('用户名已存在,请重新输入！',3);
      }
    }).catch(err => console.log('发生错误:', err));
  }
}

function regImg() {
  if (sourcesJsonParsed[sourceReg].hasOwnProperty('img_url')) {
    let tokenUrl,imgUrl;
    tokenUrl = sourcesJsonParsed[sourceReg].token_url;
    imgUrl = sourcesJsonParsed[sourceReg].img_url;

    if (sourcesJsonParsed[sourceReg].hasOwnProperty('refresh_token_url')) {
      let deviceno = makeStr(8)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(12);
      deviceno = deviceno+md5(deviceno).substring(7, 8);
      timeoutPromise(3000,reqData(tokenUrl,{"role":"guest","deviceno":deviceno,"deviceType":"yuj"},'POST'))
      .then(response => {
        if (response.ret !== 0) {
          alertInfo('验证码请求错误！');
        } else {
          reqData(sourcesJsonParsed[sourceReg].refresh_token_url,{"accessToken":response.accessToken,"refreshToken":response.refreshToken},'POST')
          .then(response => {
            if (response.ret !== 0) {
              alertInfo('验证码请求错误！');
            } else {
              reqData(imgUrl,'?accesstoken='+response.accessToken)
              .then(response => {
                const newImage = document.createElement('img');
                newImage.src = response.image.replace('\\','/');
                regImgField.innerHTML = newImage.outerHTML;
                regImgIdField.value = response.picid;
              }).catch(err => console.log('发生错误:', err));
            }
          }).catch(err => console.log('发生错误:', err));
        }
      }).catch(err => {
        console.log('发生错误:', err);
        alertInfo('无法连接此直播源！', 10);
      });
    } else {
      timeoutPromise(3000,reqData(tokenUrl,{"usagescen":1},'POST'))
      .then(response => {
        if (response.ret !== 0) {
          alertInfo('验证码请求错误！');
        } else {
          reqData(imgUrl,'?accesstoken='+response.access_token)
          .then(response => {
            const newImage = document.createElement('img');
            newImage.src = response.image.replace('\\','/');
            regImgField.innerHTML = newImage.outerHTML;
            regImgIdField.value = response.picid;
          }).catch(err => console.log('发生错误:', err));
        }
      }).catch(err => {
        console.log('发生错误:', err);
        alertInfo('无法连接此直播源！', 10);
      });
    }
  }
}

function reqSms() {
  if (sourcesJsonParsed[sourceReg].hasOwnProperty('sms_url')) {
    let regAcc = regAccField.value;
    let regImgInput = regImgInputField.value;
    let regImgId = regImgIdField.value;
    let url;
    url = sourcesJsonParsed[sourceReg].sms_url;

    reqData(url,'?pincode='+regImgInput+'&picid='+regImgId+'&verifytype=3&account='+regAcc+'&accounttype=1')
    .then(response => {
      if (response.ret !== 0) {
        alertInfo('验证码或其它错误！请重新输入！');
      } else {
        alertInfo('短信已发送！',5);
      }
    }).catch(err => console.log('发生错误:', err));
  }
}

function reqReg() {
  let acc = regAccField.value;
  acc = acc.toString();
  let pwd = regPwdField.value;
  let smsCode = regSmsField.value;

  if (!sourcesJsonParsed[sourceReg].hasOwnProperty('img_url')) {
    reqData(sourcesJsonParsed[sourceReg].reg_url,'?username='+acc+'&iconid=1&pwd='+md5(pwd)+'&birthday=1970-1-1&type=1&accounttype='+sourcesJsonParsed[sourceReg].acc_type_reg)
    .then(response => {
      if (response.ret !== 0) {
        alertInfo(sourcesJsonParsed[sourceReg].desc + '直播源注册失败，请重试！用户名不能是中文！');
      } else {
        formToggle.click();
        loginAccField.value = acc;
        loginPwdField.value = pwd;
        regAccField.value = '';
        regPwdField.value = '';
        regImgInputField.value = '';
        regSmsField.value = '';
        alertInfo('注册成功!');
        reqLogin();
      }
    }).catch(err => console.log('发生错误:', err));
  } else {
    reqData(sourcesJsonParsed[sourceReg].verify_url,'?verifycode='+smsCode+'&verifytype=3&username='+acc+'&account='+acc)
    .then(response => {
      if (response.ret === 0) {
        let user = {};
        user.account = acc;
        let deviceno = makeStr(8)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(12);
        user.deviceno = deviceno+md5(deviceno).substring(7, 8);
        user.devicetype = 'yuj';
        user.code = response.code;
        let timestamp = Date.now();
        user.signature = md5(acc+'|'+md5(pwd)+'|'+user.deviceno+'|'+user.devicetype+'|'+timestamp);
        user.birthday = '1970-1-1';
        user.username = acc;
        user.type = 1;
        user.timestamp = timestamp.toString();
        user.pwd = md5(pwd);
        user.accounttype = sourcesJsonParsed[sourceReg].acc_type_reg;

        reqData(sourcesJsonParsed[sourceReg].reg_url,user,'POST')
        .then(response => {
          if (response.ret === 0) {
            localStorage.setItem(sourceReg+'_deviceno', user.deviceno);
            formToggle.click();
            loginAccField.value = acc;
            loginPwdField.value = pwd;
            regAccField.value = '';
            regPwdField.value = '';
            regImgInputField.value = '';
            regSmsField.value = '';
            alertInfo('注册成功!');
            reqLogin();
          } else {
            alertInfo('注册失败,手机号已存在！', 10);
          }
        }).catch(err => console.log('发生错误:', err));
      } else {
        alertInfo('短信验证失败,请重试！');
      }
    }).catch(err => console.log('发生错误:', err));
  }
}

function reqLogin() {
  let acc = loginAccField.value;
  acc = acc.toString();
  let pwd = loginPwdField.value;
  let deviceno;
  if (localStorage.getItem(sourceReg+'_deviceno')) {
    deviceno = localStorage.getItem(sourceReg+'_deviceno');
  } else {
    deviceno = makeStr(8)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(12);
    deviceno = deviceno + md5(deviceno).substring(7, 8);
  }
  let devicetype = 3;
  let isforce = 1;

  if (!sourcesJsonParsed[sourceReg].hasOwnProperty('img_url')) {
    reqData(sourcesJsonParsed[sourceReg].login_url,'?deviceno='+deviceno+'&devicetype='+devicetype+'&accounttype='+sourcesJsonParsed[sourceReg].acc_type_login+'&accesstoken=(null)&account='+acc+'&pwd='+md5(pwd)+'&isforce='+isforce)
    .then(response => {
      if (response.ret === 0) {
        alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源登录成功！',5);
        localStorage.setItem(sourceReg+'_acc', acc);
        localStorage.setItem(sourceReg+'_pwd', pwd);
        localStorage.setItem(sourceReg+'_token', response.access_token);
        localStorage.setItem(sourceReg+'_deviceno', deviceno);
        initialize();
      } else {
        alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源登录失败！',10);
      }
    }).catch(err => console.log('发生错误:', err));
  } else {
    let user = {};
    user.account = acc;
    user.deviceno = deviceno;
    user.pwd = md5(pwd);
    user.devicetype = 'yuj';
    user.businessplatform = 1;
    let timestamp = Date.now();
    user.signature = md5(deviceno+'|'+user.devicetype+'|'+sourcesJsonParsed[sourceReg].acc_type_login+'|'+acc+"|"+timestamp);
    user.isforce = 1;
    user.extendinfo = sourcesJsonParsed[sourceReg].extend_info;
    if (sourcesJsonParsed[sourceReg].server_version) {
      user.serverVersion = sourcesJsonParsed[sourceReg].server_version;
    }
    user.timestamp = timestamp.toString();
    user.accounttype = sourcesJsonParsed[sourceReg].acc_type_login;

    timeoutPromise(3000,reqData(sourcesJsonParsed[sourceReg].login_url,user,'POST'))
    .then(response => {
      if (response.ret !== 0) {
        alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源登录失败！',10);
      } else {
        alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源登录成功！',5);
        localStorage.setItem(sourceReg+'_acc', acc);
        localStorage.setItem(sourceReg+'_pwd', pwd);
        localStorage.setItem(sourceReg+'_token', response.access_token);
        initialize();
      }
    }).catch(err => {
      console.log('登录发生错误:', err);
      alertInfo('无法连接'+sourcesJsonParsed[sourceReg].desc+'直播源!', 10);
    });
  }
}

function appendList(channel,appendSourceName,sourceLane) {
  const channelListItem = document.createElement('li');
  const channelListText = document.createTextNode(channel.chnl_name);
  if (localStorage.getItem('dark') === '1'){
    channelListItem.classList.add('white');
  }
  if (localStorage.getItem(appendSourceName+'_token') || jsonChannels.hasOwnProperty(appendSourceName)){
    channelListItem.classList.add('working');
  }
  channelListItem.setAttribute('data-value',channel.chnl_id);
  channelListItem.setAttribute('data-source',appendSourceName);
  channelListItem.appendChild(channelListText);
  if (channel.chnl_cat.indexOf('高清') === -1) {
    const channelSup = document.createElement('sub');
    channelSup.textContent = sourceLane;
    channelListItem.appendChild(channelSup);
  }
  switch (channel.chnl_cat) {
    case '高清电信':
      myList1.appendChild(channelListItem);
      break;
    case '高清联通':
      myList1a.appendChild(channelListItem);
      break;
    case '标清':
      myList2.appendChild(channelListItem);
      break;
    case '央视':
      myList3.appendChild(channelListItem);
      break;
    case '卫视':
      myList4.appendChild(channelListItem);
      break;
    case '地方':
      myList5.appendChild(channelListItem);
      break;
    case '专业':
      myList8.appendChild(channelListItem);
      break;
    case '港澳台':
      myList9.appendChild(channelListItem);
      break;
    default:
      break;
  }
}

function reqJson(json) {
  timeoutPromise(5000,reqData(json))
  .then(response => {
    if (response.ret === 0) {
      let newChannel={};
      jsonChannels[response.data[0].name] = {};
      for (let index = 0; index < response.data[0].channels.length; index++) {
        const channel = response.data[0].channels[index];
        jsonChannels[response.data[0].name][channel.chnl_id] = channel.url;
        newChannel.chnl_name = channel.chnl_name;
        newChannel.chnl_id = channel.chnl_id;
        newChannel.chnl_cat = channel.chnl_cat;
        appendList(newChannel,response.data[0].name,response.data[0].lane);
      }
    }
  }).catch(err => {
    console.log('发生错误:', err);
  });
}

function getToken(source) {
  return new Promise((resolve, reject) => {
    if (localStorage.getItem(source.name+'_token')) {
        resolve(localStorage.getItem(source.name+'_token'));
    } else if (source.hasOwnProperty('refresh_token_url')) {
      let deviceno = makeStr(8)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(4)+"-"+makeStr(12);
      deviceno = deviceno+md5(deviceno).substring(7, 8);
      timeoutPromise(3000,reqData(source.token_url,{"role":"guest","deviceno":deviceno,"deviceType":"yuj"},'POST'))
      .then(response => {
        if (response.ret === 0) {
          reqData(source.refresh_token_url,{"accessToken":response.accessToken,"refreshToken":response.refreshToken},'POST')
          .then(response => {
            if (response.ret === 0) {
              resolve(response.accessToken);
            }
          }).catch(err => {reject(err);});
        }
      }).catch(err => {reject(err);});
    } else {
      timeoutPromise(3000,reqData(source.token_url,{"usagescen":1},'POST'))
      .then(response => {
        if (response.ret === 0) {
          resolve(response.access_token);
        }
      }).catch(err => {reject(err);});
    }
  });
}

function reqChannels(source,token) {
  timeoutPromise(5000,reqData(source.list_url,'?pageidx=1&pagenum=500&accesstoken='+token))
  .then(response => {
    if (response.ret === 0) {
      let channelCats;
      let cats = {"001":"高清"+source.lane,"002":"标清","003":"央视","004":"卫视","005":"地方","008":"专业"};
      let omitArr = [];
      if (source.omit) {
        let omitSourceArr = source.omit.split(',');
        for (let index = 0; index < omitSourceArr.length; index++) {
          if (omitSourceArr[index].indexOf('-') !== -1) {
            let omitSubArr = omitSourceArr[index].split('-');
            for (let a = Number(omitSubArr[0]); a <= Number(omitSubArr[1]); a++) {
              omitArr.push(Number(a));
            }
          } else {
            omitArr.push(Number(omitSourceArr[index]));
          }
        }
      }
      for (let b = 0; b < response.chnl_list.length; b++) {
        const channel = response.chnl_list[b];
        if (source.omit && omitArr.indexOf(Number(channel.chnl_id.toString().slice(-3))) !== -1) {
          continue;
        }
        let newChannel={};
        channelCats = channel.sub_type.split('|');
        for (let c = 0; c < channelCats.length; c++) {
          let channelCat = channelCats[c].slice(-3);
          if (sourcesJsonParsed[source.name].hasOwnProperty('fix_cats') && sourcesJsonParsed[source.name].fix_cats.hasOwnProperty(channelCat)) {
            channelCat = sourcesJsonParsed[source.name].fix_cats[channelCat];
          }
          if (cats[channelCat] === undefined) {
            continue;
          }
          newChannel.chnl_name = channel.chnl_name;
          newChannel.chnl_id = channel.chnl_id;
          newChannel.chnl_cat = cats[channelCat];
          appendList(newChannel,source.name,source.lane);
        }
      }
    } else {
      alertInfo(sourcesJsonParsed[source.name].desc+'直播源错误！需重新注册或登录！',10);
      localStorage.removeItem(source.name+'_acc');
      localStorage.removeItem(source.name+'_pwd');
      localStorage.removeItem(source.name+'_token');
      localStorage.removeItem(source.name+'_deviceno');
    }
  }).catch(err => {
    alertInfo('无法连接'+sourcesJsonParsed[source.name].desc+'直播源！',10);
    console.log('发生错误:', err);
  });
}

function reqAuth() {
  timeoutPromise(3000,reqData(sourcesJsonParsed[sourceReg].auth_info_url,'?accesstoken='+localStorage.getItem(sourceReg+'_token')+'&programid='+programId+'&playtype=live&protocol=hls&verifycode='+localStorage.getItem(sourceReg+'_deviceno')))
  .then(response => {
    if (response.ret === 0) {
      let playToken = response.play_token;
      let authtoken = md5('ipanel123#%#&*(&(*#*&^*@#&*%()#*()$)#@&%(*@#()*%321ipanel'+response.auth_random_sn);
      timeoutPromise(3000,reqData(sourcesJsonParsed[sourceReg].auth_verify_url,'?programid='+programId+'&playtype=live&protocol=hls&accesstoken='+localStorage.getItem(sourceReg+'_token')+'&verifycode='+localStorage.getItem(sourceReg+'_deviceno')+'&authtoken='+authtoken))
      .then(response => {
        if (response.ret === 0) {
          hlsVideoUrl = sourcesJsonParsed[sourceReg].play_url+'?playtype=live&protocol=hls&accesstoken='+localStorage.getItem(sourceReg+'_token')+'&programid='+programId+'&playtoken='+playToken+'&verifycode='+localStorage.getItem(sourceReg+'_deviceno');
          videojsLoad();
        } else {
          alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源发生错误！',10);
        }
      }).catch(err => {
        alertInfo('无法连接'+sourcesJsonParsed[sourceReg].desc+'直播源！',10);
        console.log('发生错误:', err);
      });;
    } else {
      alertInfo(sourcesJsonParsed[sourceReg].desc+'直播源错误！需重新注册或登录！',10);
      localStorage.removeItem(sourceReg+'_acc');
      localStorage.removeItem(sourceReg+'_pwd');
      localStorage.removeItem(sourceReg+'_token');
      localStorage.removeItem(sourceReg+'_deviceno');
    }
  }).catch(err => {
    alertInfo('无法连接'+sourcesJsonParsed[sourceReg].desc+'直播源！',10);
    console.log('发生错误:', err);
  });
  updateAside();
}

function parseJson(json) {
  let newJson = {};
  for (let index = 0; index < json.data.length; index++) {
    const element = json.data[index];
    if (element.play_url) {
      const sourcesListItem = document.createElement('li');
      sourcesListItem.textContent = element.desc;
      sourcesListItem.className = 'source_' + element.name;
      if (localStorage.getItem('dark') === '1'){
        sourcesListItem.classList.add('white');
      }
      sourcesField.appendChild(sourcesListItem);
    }

    let newIndex = element.name;
    newJson[newIndex] = element;
  }
  if (!sourcesField.firstChild) {
    sourcesField.textContent = '无';
  }
  sourcesJsonParsed = newJson;
}

function updateAside() {
  const selected = document.querySelector('.sourceReg');
  if(selected) selected.classList.remove('sourceReg');
  document.querySelector('.source_'+sourceReg).classList.add('sourceReg');
  if (sourcesJsonParsed[sourceReg].hasOwnProperty('access_token')) {
    fieldsetLoginForm.setAttribute("disabled","disabled");
    fieldsetRegForm.setAttribute("disabled","disabled");
    formToggle.disabled = true;
    return;
  } else if (!sourcesJsonParsed[sourceReg].hasOwnProperty('play_url')) {
    sourceReg = 'jscnwx';
    loginAccField.setAttribute('placeholder','用户名');
    regAccField.setAttribute('placeholder','用户名');
  } else if (!sourcesJsonParsed[sourceReg].hasOwnProperty('img_url')) {
    loginAccField.setAttribute('placeholder','用户名');
    regAccField.setAttribute('placeholder','用户名');
    regImgField.classList.toggle('hidden',true);
    regImgInputField.classList.toggle('hidden',true);
    regSmsField.classList.toggle('hidden',true);
  } else {
    loginAccField.setAttribute('placeholder','手机号');
    regAccField.setAttribute('placeholder','手机号');
    regImgField.classList.toggle('hidden',false);
    regImgInputField.classList.toggle('hidden',false);
    regSmsField.classList.toggle('hidden',false);
  }
  fieldsetLoginForm.removeAttribute("disabled");
  fieldsetRegForm.removeAttribute("disabled");
  formToggle.disabled = false;
  loginAccField.value = localStorage.getItem(sourceReg+'_acc');
  loginPwdField.value = localStorage.getItem(sourceReg+'_pwd');
}

function resetSourceReg() {
  sourceReg = 'jscnwx';
  programId = undefined;
  updateAside();
}

function setOverlay() {
  const videoOverlay = document.querySelector('.vjs-overlay');
  if (videoOverlay) {
    if (document.fullscreenElement) {
      let width = window.screen.width * window.devicePixelRatio;
      let height = window.screen.height * window.devicePixelRatio;
      let videoWidth,videoHeight,overlayWidth,overlayHeight,marginLeft,marginTop;
      if (width > height) {
        videoHeight = height;
        videoWidth = videoHeight * 16 / 9;
      } else {
        videoWidth = width;
        videoHeight = videoWidth * 9 / 16;
      }
      overlayWidth = Math.floor(videoWidth * 19 / 100 / window.devicePixelRatio);
      overlayHeight = Math.floor(videoHeight * 15 / 100 / window.devicePixelRatio);
      marginLeft = Math.floor(videoWidth * 28 / 100 / window.devicePixelRatio);
      marginTop = Math.floor(videoHeight * 30 / 100 / window.devicePixelRatio);

      videoOverlay.setAttribute('style', 'width:' + overlayWidth +'px; height: ' + overlayHeight + 'px; margin-left: ' + marginLeft + 'px; margin-top: ' + marginTop + 'px;');
    } else {
      videoOverlay.removeAttribute('style');
    }
  }
}

let sourcesJson,sourcesJsonParsed,jsonChannels={},hlsVideoUrl;
let sourceReg = 'jscnwx';
let programId;
let localJson = 'channels.json';
let remoteJson = 'http://hbo.epub.fun/channels.json';
const videoField = document.querySelector('.videoContainer');
const sourcesField = document.querySelector('.sources');
const fieldsetLoginForm = document.querySelector('.loginForm fieldset');
const loginForm = document.querySelector('.loginForm');
const loginAccField = document.querySelector('.loginAcc');
const loginPwdField = document.querySelector('.loginPwd');
const loginBtn = document.querySelector('.loginBtn');
const fieldsetRegForm = document.querySelector('.regForm fieldset');
const regForm = document.querySelector('.regForm');
const regAccField = document.querySelector('.regAcc');
const regPwdField = document.querySelector('.regPwd');
const regImgField = document.querySelector('.regImg');
const regImgInputField = document.querySelector('.regImgInput');
const regImgIdField = document.querySelector('.regImgId');
const regSmsField = document.querySelector('.regSms');
const regBtn = document.querySelector('.regBtn');
const infoField = document.querySelector('h4');
const formToggle = document.querySelector('.formToggle');
const channelsField = document.querySelector('.channels');
const categoriesField = document.querySelector('.categories');
const switchBtn = document.querySelector('.switch');
const myList1 = document.querySelector('.channels ul:nth-child(1)');
const myList1a = document.querySelector('.channels ul:nth-child(2)');
const myList2 = document.querySelector('.channels ul:nth-child(3)');
const myList3 = document.querySelector('.channels ul:nth-child(4)');
const myList4 = document.querySelector('.channels ul:nth-child(5)');
const myList5 = document.querySelector('.channels ul:nth-child(6)');
const myList8 = document.querySelector('.channels ul:nth-child(7)');
const myList9 = document.querySelector('.channels ul:nth-child(8)');

let liveui = true;
if (videojs.browser.IS_ANDROID || videojs.browser.IS_IOS) {
  liveui = false;
}

fetch(localJson).then(response => {
  let contentType;
  if(response.ok) {
    contentType = response.headers.get("content-type");
    if(contentType && contentType.includes("application/json")) {
      return response.json();
    }
  }
  fetch(remoteJson).then(response => {
    if(response.ok) {
      contentType = response.headers.get("content-type");
      if(contentType && contentType.includes("application/json")) {
        return response.json();
      }
    }
  }).then(json => {
    sourcesJson = json;
    parseJson(json);
    initialize();
  }).catch(err => {
    console.log('发生错误:', err.message);
  });
  throw new Error('本地频道不存在，尝试连接远程频道...');
}).then(json => {
  sourcesJson = json;
  parseJson(json);
  initialize();
}).catch(err => {
  console.log('发生错误:', err);
});

function initialize() {
  myList1.textContent = '';
  myList1.classList.add('myList1');
  myList1a.textContent = '';
  myList1a.classList.add('myList1a');
  myList1a.classList.add('hidden');
  myList2.textContent = '';
  myList2.classList.add('myList2');
  myList2.classList.add('hidden');
  myList3.textContent = '';
  myList3.classList.add('myList3');
  myList3.classList.add('hidden');
  myList4.textContent = '';
  myList4.classList.add('myList4');
  myList4.classList.add('hidden');
  myList5.textContent = '';
  myList5.classList.add('myList5');
  myList5.classList.add('hidden');
  myList8.textContent = '';
  myList8.classList.add('myList8');
  myList8.classList.add('hidden');
  myList9.textContent = '';
  myList9.classList.add('myList9');
  myList9.classList.add('hidden');
  for (let index = 0; index < sourcesJson.data.length; index++) {
    const source = sourcesJson.data[index];
    if (source.hasOwnProperty('json')) {
      reqJson(source.json);
    }
    if (source.hasOwnProperty('list_url')) {
      getToken(source).then(response => {reqChannels(source,response);})
      .catch(err => {console.log('发生错误:', err);});
    }
    if (source.hasOwnProperty('access_token')) {
      localStorage.setItem(source.name+'_token', source.access_token);
    }
    if (source.hasOwnProperty('channels')) {
      for (let a = 0; a < source.channels.length; a++) {
        if (source.channels[a].hasOwnProperty('chnl_cat')) {
          appendList(source.channels[a],source.name,source.lane);
        }
      }
    }
  }

  if (localStorage.getItem(sourceReg+'_acc') && localStorage.getItem(sourceReg+'_pwd')){
    loginAccField.value = localStorage.getItem(sourceReg+'_acc');
    loginPwdField.value = localStorage.getItem(sourceReg+'_pwd');
  }

  updateAside();
  playVideo();
}

formToggle.addEventListener("click", function(e) {
  e.preventDefault();
  loginForm.classList.toggle('hidden');
  regForm.classList.toggle('hidden');
  if (formToggle.textContent === '注册') {
    formToggle.textContent = '登录';
  } else {
    formToggle.textContent = '注册';
  }
});

regAccField.addEventListener("change", uniqueName);
regAccField.addEventListener("change", regImg);
regImgField.addEventListener("click", regImg);
regImgInputField.addEventListener("change", reqSms);
regBtn.addEventListener("click", reqReg);
loginBtn.addEventListener("click", reqLogin);
sourcesField.addEventListener("click", switchSource);
categoriesField.addEventListener("click", switchCategory);
channelsField.addEventListener("click", switchChannel);
document.addEventListener("fullscreenchange", setOverlay);
document.addEventListener("webkitfullscreenchange", setOverlay);
document.addEventListener("mozfullscreenchange", setOverlay);
document.addEventListener("msfullscreenchange", setOverlay);
document.addEventListener("orientationchange", setOverlay);

if (localStorage.getItem('dark') === '1'){
  switchBtn.click();
}
  </script>
</body>
</html>